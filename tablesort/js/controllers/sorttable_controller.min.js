oSortTable={addCSS(e){var t=document.getElementsByTagName("head")[0],r=document.createElement("style");r.setAttribute("type","text/css"),r.appendChild(document.createTextNode(e)),t.appendChild(r)},getSortFunc(e,t){var r="";switch(e.toLowerCase()){case"date":r="Date";break;case"number":r="Number";break;default:r="String"}return r="sort"+r,"descending"==t&&(r+="Desc"),oSortTable[r]},sortDate:(e,t)=>new Date(e.value)-new Date(t.value),sortDateDesc:(e,t)=>oSortTable.sortDate(t,e),sortNumber:(e,t)=>e.value-t.value,sortNumberDesc:(e,t)=>oSortTable.sortNumber(t,e),sortString:(e,t)=>e.value.toLowerCase()<t.value.toLowerCase()?-1:e.value.toLowerCase()>t.value.toLowerCase()?1:0,sortStringDesc:(e,t)=>oSortTable.sortString(t,e),getCellValue(e){var t="",r=e.getElementsByTagName("input");return t=(t=0==e.textContent.length&&1==r.length?r[0].value:e.textContent).trim(),t=oSortTable.extractCurrencyAmount(t),t=oSortTable.stripNumericCommas(t)},extractCurrencyAmount(e){let t=e.match(/^[£€$]\s*(\d+\.?\d*)/);return t&&t[1]?parseFloat(t[1]):e},stripNumericCommas(e){let t=e.match(/^\d{1,3}(,\d{3})*(\.\d+)?$/);return t?parseFloat(e.replace(/,/g,"")):e}},application.register("sort-table",class extends Stimulus.Controller{static values={autoHead:Boolean};initialize(){oSortTable.addCSS(`[data-controller~="sort-table"] [data-sort-table-type]:hover {cursor: pointer;}[data-controller~="sort-table"] [data-sort-table-type="none" i]:hover {cursor: initial;}`)}connect(){this.runWaitingCode(()=>this.setUp())}setUp(){this.element.dataset.sortTableAutoHead&&(this.autoHeadValue=this.element.dataset.sortTableAutoHead),this.element[this.identifier]=this,this.setUpHeadBody(),this.setUpValues(),this.setUpColTypes()}runWaitingCode(e){this.busy(!0),setTimeout(()=>{e(),this.busy(!1)},0)}disconnect(){}busy(e){this.element.ariaBusy=e}sort(e){var t=this._getElemChildNum(e.currentTarget);this.sortByIndex(t)}sortByName(e){for(var t=this.element.querySelectorAll("th[data-sort-table-type]"),r=0;r<t.length;r++){var a=t[r];if(e.toLowerCase()==a.textContent.toLowerCase())return this.sortByIndex(r)}}sortByIndex(e){this.runWaitingCode(()=>this._sortByIndex(e))}_sortByIndex(e){var t=this._getSortDir(e),r=this._getColSortType(e);if("none"!=r.toLowerCase()){var a=this._getColumnCells(e);a.sort(oSortTable.getSortFunc(r,t)),this._removeAriaSorts(),this._applySortRows(a),this.element.querySelectorAll("th")[e].setAttribute("aria-sort",t)}}setUpHeadBody(){if(!this.element.getElementsByTagName("thead").length){if(!this.autoHeadValue)throw Error('Sort Table can only sort tables with a thead element. Please add one or add data-sort-table-auto-head="true" to the table and Data Sort will make the first row a thead.');var e=this.element.getElementsByTagName("tr"),t=document.createElement("thead");e.length&&(t.appendChild(e[0]),this.element.insertBefore(t,this.element.firstChild))}}setUpColTypes(){for(var e=this.element.querySelectorAll("th:not([data-sort-table-type]"),t=0;t<e.length;t++)e[t].dataset.sortTableType=this.guesColType(t);var e=this.element.querySelectorAll("th:not([data-action]");for(let r of e)"none"!=r.dataset.sortTableType.toLowerCase()&&(r.dataset.action="click->sort-table#sort");var e=this.element.querySelectorAll("th[data-action]");for(let a of e)a.dataset.action.toLowerCase().includes("sort-table")&&a.setAttribute("role","button")}setUpValues(){var e=this.element.querySelectorAll("td:not([data-sort-table-val])");for(let t of e)t.dataset.sortTableVal=oSortTable.getCellValue(t)}_applySortRows(e){var t=document.createElement("tbody"),r=this.element.getElementsByTagName("tbody")[0];for(var a in e)t.appendChild(e[a].element);r.parentNode.replaceChild(t,r)}_formatDate(e){var t=new Date(e),r=""+(t.getMonth()+1),a=""+t.getDate(),s=t.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),[s,r,a].join("-")}_getColSortType(e){return this.element.querySelectorAll("th[data-sort-table-type]")[e].dataset.sortTableType}_getColumnCells(e){for(var t=[],r=this.element.getElementsByTagName("tbody")[0],a=0;a<r.rows.length;a++){var s=r.rows[a].cells[e];t.push({value:s.dataset.sortTableVal,element:s.parentNode})}return t}_getElemChildNum(e){for(var t=e.parentNode,r=0;r<t.children.length;r++)if(t.children[r]===e)return r}_getSortDir(e){return"ascending"==this.element.querySelectorAll("th")[e].getAttribute("aria-sort")?"descending":"ascending"}guesColType(e){for(var t="",r=this.element.getElementsByTagName("tbody")[0],a=0,s=r.rows.length,l=0;l<s&&(!(a=r.rows[l].cells[e].dataset.sortTableVal).length||"string"!=(t=a.match(/^-?[£$¤]?[\d,.]+%?$/)?0==t.length||"number"==t?"number":"string":a.match(/^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)$/)&&(0==t.length||"date"==t)?"date":"string"));l++);return t}_removeAriaSorts(){var e=this.element.querySelectorAll("th");for(let t of e)t.removeAttribute("aria-sort")}});